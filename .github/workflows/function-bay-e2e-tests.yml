name: Function Bay E2E Tests

on:
  push:
    branches: [main, feature/**]
    paths:
      - 'service/**'
      - 'packages/**'
      - 'clients/**'
      - 'package.json'
      - 'bun.lock'
      - '.github/workflows/function-bay-e2e-tests.yml'
  pull_request:
    branches: [main]
    paths:
      - 'service/**'
      - 'packages/**'
      - 'clients/**'
      - 'package.json'
      - 'bun.lock'

jobs:
  e2e-tests:
    name: Run Function Bay E2E Tests
    uses: metorial/.github/.github/workflows/reusable-e2e-tests.yml@main
    with:
      service_directory: service
      compose_project_prefix: function-bay-ci
      compose_profiles: 'infra service'
      wait_services: |
        function-bay-postgres
        function-bay-redis
        function-bay-object-storage
        function-bay-forge
        function-bay-service
      test_container: function-bay-service
      test_command: cd /app/service && bun run test -- --mode ci --reporter verbose
